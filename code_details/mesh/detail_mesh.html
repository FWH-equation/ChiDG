

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Computational Grid &mdash; ChiDG 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  

  
    <link rel="top" title="ChiDG 0.1 documentation" href="../../index.html"/>
        <link rel="up" title="Code details" href="../details_main.html"/>
        <link rel="next" title="Equation Sets" href="../equations/detail_equations.html"/>
        <link rel="prev" title="Finding your way around ChiDG" href="../architecture/detail_architecture.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ChiDG
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/getting_started.html#build-from-source">Build from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#step-1-get-chidg">Step 1: Get ChiDG</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#step-2-check-the-compilers">Step 2: Check the compilers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#step-3-install-the-dependencies">Step 3: Install the dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/getting_started.html#cmake">CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/getting_started.html#hdf5">HDF5</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/getting_started.html#metis">METIS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/getting_started.html#mpi">MPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/getting_started.html#blas-and-lapack">BLAS and LAPACK</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#step-4-configure-the-build">Step 4: Configure the build</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#step-5-build-chidg">Step 5: Build ChiDG</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#step-6-test-chidg">Step 6: Test ChiDG</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/getting_started.html#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#chidg-executable-chidg">ChiDG Executable: <code class="docutils literal"><span class="pre">chidg</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/getting_started.html#running-chidg">Running ChiDG</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#step-1-create-a-chidg-formatted-grid-file">Step 1: Create a ChiDG-formatted grid file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#step-2-create-a-chidg-nml-input-file">Step 2: Create a <code class="docutils literal"><span class="pre">chidg.nml</span></code> input file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/getting_started.html#step-3-run-chidg">Step 3: Run <code class="docutils literal"><span class="pre">chidg</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../details_main.html">Code details</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../chidg/detail_chidg.html">ChiDG API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture/detail_architecture.html">Finding your way around ChiDG</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../architecture/detail_architecture.html#source-layout-chidg-src">Source Layout <code class="docutils literal"><span class="pre">chidg/src</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../architecture/detail_architecture.html#chidg-modules">ChiDG Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../architecture/detail_architecture.html#chidg-datatypes-type-datatype-f90">ChiDG Datatypes <code class="docutils literal"><span class="pre">type_datatype.f90</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../architecture/detail_architecture.html#chidg-topics-src-topic">ChiDG Topics <code class="docutils literal"><span class="pre">src/topic</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Computational Grid</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coordinate-systems">Coordinate Systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mesh">Mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#domain">Domain</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#elements">Elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#faces">Faces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#chimera-interfaces">Chimera Interfaces</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../equations/detail_equations.html">Equation Sets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../equations/detail_equations_theory.html">Theory + Abstractions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../equations/detail_equations_theory.html#mathematical-background">Mathematical background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../equations/detail_equations_theory.html#chidg-operators">ChiDG Operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../equations/detail_equations_theory.html#chidg-equation-sets">ChiDG Equation Sets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../equations/detail_equations_fluid.html">Fluid Equations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../equations/detail_equations_fluid.html#fluid-advection">Fluid Advection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../equations/detail_equations_fluid.html#fluid-diffusion">Fluid Diffusion</a></li>
<li class="toctree-l4"><a class="reference internal" href="../equations/detail_equations_fluid.html#models">Models</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../boundary_conditions/detail_boundary_conditions.html">Boundary conditions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../boundary_conditions/detail_bc_theory.html">Theory + Abstractions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../boundary_conditions/detail_bc_theory.html#boundary-condition-patch">Boundary condition patch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../boundary_conditions/detail_bc_theory.html#boundary-condition-state-functions">Boundary condition state functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../boundary_conditions/detail_bc_fluid.html">Fluid boundary conditions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../boundary_conditions/detail_bc_fluid.html#inlet-total">Inlet - Total</a></li>
<li class="toctree-l4"><a class="reference internal" href="../boundary_conditions/detail_bc_fluid.html#outlet-constant-pressure">Outlet - Constant Pressure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../boundary_conditions/detail_bc_fluid.html#wall">Wall</a></li>
<li class="toctree-l4"><a class="reference internal" href="../boundary_conditions/detail_bc_fluid.html#symmetry">Symmetry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../boundary_conditions/detail_bc_fluid.html#farfield">Farfield</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../boundary_conditions/detail_bc_periodic.html">Periodic boundary condition</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../solvers/detail_solvers.html">Solvers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../solvers/detail_solvers.html#time-integrators">Time Integrators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#chidg-representation">ChiDG Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#implicit-integrators">Implicit integrators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#explicit-integrators">Explicit integrators</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../solvers/detail_solvers.html#nonlinear-solvers">Nonlinear solvers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#id1">ChiDG Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#newton">Newton</a></li>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#quasi-newton">Quasi-Newton</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../solvers/detail_solvers.html#linear-solvers">Linear Solvers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#id2">ChiDG Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#flexible-generalized-minimum-residual">Flexible Generalized Minimum Residual</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../solvers/detail_solvers.html#preconditioners">Preconditioners</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#id4">ChiDG Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#block-jacobi">block-Jacobi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#block-ilu0">block-ILU0</a></li>
<li class="toctree-l4"><a class="reference internal" href="../solvers/detail_solvers.html#restricted-additive-schwarz-block-ilu0">Restricted Additive Schwarz + block-ILU0</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../containers/detail_containers.html">ChiDG Matrix/Vector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../containers/detail_containers.html#chidg-vector">ChiDG Vector</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../containers/detail_containers.html#block-vector">Block Vector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../containers/detail_containers.html#dense-vector">Dense Vector</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../containers/detail_containers.html#chidg-matrix">ChiDG Matrix</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../containers/detail_containers.html#block-matrix">Block Matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../containers/detail_containers.html#dense-matrix">Dense Matrix</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../parallel/detail_parallel.html">Parallelization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../parallel/detail_parallel.html#chidg-mpi">ChiDG MPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parallel/detail_parallel.html#domain-decomposition">Domain decomposition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parallel/detail_parallel.html#parallel-matrix-vector-operations">Parallel matrix:vector operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../parallel/detail_parallel.html#chidg-matrix">chidg_matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../parallel/detail_parallel.html#chidg-vector">chidg_vector</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../parallel/detail_parallel.html#parallel-efficiency">Parallel efficiency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parallel/detail_parallel.html#parallel-preconditioning">Parallel preconditioning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../parallel/detail_parallel.html#block-jacobi">Block-Jacobi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../parallel/detail_parallel.html#restricted-additive-schwarz">Restricted Additive Schwarz</a></li>
<li class="toctree-l4"><a class="reference internal" href="../parallel/detail_parallel.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../autodiff/detail_autodiff.html">Automatic Differentiation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../autodiff/detail_autodiff.html#dnad-dual-number-automatic-differentiation">DNAD - Dual Number Automatic Differentiation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/example_main.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/smoothbump/example_smoothbump.html">Smooth bump</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/smoothbump/example_smoothbump.html#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/smoothbump/example_smoothbump.html#setup">Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../examples/smoothbump/example_smoothbump.html#setup-from-scratch">Setup from scratch:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../examples/smoothbump/example_smoothbump.html#use-setup-provided">Use setup provided:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/smoothbump/example_smoothbump.html#results">Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/naca2412/example_naca2412.html">NACA 2412 Airfoil</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/naca2412/example_naca2412.html#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/naca2412/example_naca2412.html#set-up">Set-up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/naca2412/example_naca2412.html#results">Results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ChiDG</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../details_main.html">Code details</a> &raquo;</li>
      
    <li>Computational Grid</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/code_details/mesh/detail_mesh.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="computational-grid">
<h1>Computational Grid<a class="headerlink" href="#computational-grid" title="Permalink to this headline">¶</a></h1>
<div class="section" id="coordinate-systems">
<h2>Coordinate Systems<a class="headerlink" href="#coordinate-systems" title="Permalink to this headline">¶</a></h2>
<p>ChiDG supports two coordinate systems: <code class="docutils literal"><span class="pre">Cartesian</span></code> and <code class="docutils literal"><span class="pre">Cylindrical</span></code>. In the
code, many things are referred to only by coordinate index. The convention for these
indices is defined here as:</p>
<div class="math">
\[ \begin{align}\begin{aligned}(x,y,z) \rightarrow (1,2,3)\\(r, \theta, z)  \rightarrow (1,2,3)\end{aligned}\end{align} \]</div>
<a class="reference internal image-reference" href="../../_images/d__coordinate_systems.png"><img alt="../../_images/d__coordinate_systems.png" class="align-center" src="../../_images/d__coordinate_systems.png" style="width: 90%;" /></a>
<p>Additionally, effort has been put forth to represent data in a manner consistent
with vector-calculus. For example, test function gradient components are computed
as:</p>
<div class="math">
\[ \begin{align}\begin{aligned}\nabla \psi = \frac{\partial \psi}{\partial x}\hat{x} + \frac{\partial \psi}{\partial y} \hat{y} + \frac{\partial \psi}{\partial z} \hat{z}\\\nabla \psi = \frac{\partial \psi}{\partial r}\hat{r} + \frac{1}{r}\frac{\partial \psi}{\partial \theta} \hat{\theta} + \frac{\partial \psi}{\partial z} \hat{z}\end{aligned}\end{align} \]</div>
<p>The transformation between <code class="docutils literal"><span class="pre">Cartesian</span></code> and <code class="docutils literal"><span class="pre">Cylindrical</span></code> coordinates is given by</p>
<div class="math">
\[\begin{split}x &amp;= r cos(\theta)       \quad\quad\quad r &amp;= \sqrt{x^2 + y^2} \\
y &amp;= r sin(\theta)       \quad\quad\quad \theta &amp;= \text{atan2}(y,x) \\
z &amp;= z                   \quad\quad\quad\quad\quad \: \: z &amp;= z\end{split}\]</div>
</div>
<div class="section" id="mesh">
<h2>Mesh<a class="headerlink" href="#mesh" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal"><span class="pre">mesh_t</span></code> instance contains the entire description of the computational grid for
the local processor. A <code class="docutils literal"><span class="pre">mesh_t</span></code> conatains an array of <code class="docutils literal"><span class="pre">domain_t</span></code> objects, one
for each block. A <code class="docutils literal"><span class="pre">mesh_t</span></code> object also contains boundary condition geometry,
located in the <code class="docutils literal"><span class="pre">bc_patch_group</span></code> component. The <code class="docutils literal"><span class="pre">bc_patch_group</span></code> objects
are independent of the <code class="docutils literal"><span class="pre">domains</span></code>. A given <code class="docutils literal"><span class="pre">bc_patch_group</span></code> could potentially
include references to faces on multiple <code class="docutils literal"><span class="pre">domain</span></code> objects.</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="kd">::</span> <span class="n">mesh_t</span>

    <span class="k">type</span><span class="p">(</span><span class="n">domain_t</span><span class="p">),</span>         <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">domain</span><span class="p">(:)</span>
    <span class="k">type</span><span class="p">(</span><span class="n">bc_patch_group_t</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">bc_patch_group</span><span class="p">(:)</span>

<span class="k">contains</span>


<span class="k">end type </span><span class="n">mesh_t</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/d__mesh.png"><img alt="../../_images/d__mesh.png" class="align-center" src="../../_images/d__mesh.png" style="width: 90%;" /></a>
</div>
<div class="section" id="domain">
<h2>Domain<a class="headerlink" href="#domain" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">domain_t</span></code> data structure contains an entire geometry description for a single
domain. This exists as an array of <code class="docutils literal"><span class="pre">element_t</span></code> types, and array of <code class="docutils literal"><span class="pre">face_t</span></code> types,
and a <code class="docutils literal"><span class="pre">chimera_t</span></code> instance. An <code class="docutils literal"><span class="pre">element_t</span></code> exists for every element in the <code class="docutils literal"><span class="pre">domain_t</span></code>
domain. For a given <code class="docutils literal"><span class="pre">element_t</span></code>, a <code class="docutils literal"><span class="pre">face_t</span></code> instance exists for each face.</p>
<a class="reference internal image-reference" href="../../_images/d_mesh_exploded.png"><img alt="../../_images/d_mesh_exploded.png" class="align-center" src="../../_images/d_mesh_exploded.png" style="width: 90%;" /></a>
<a class="reference internal image-reference" href="../../_images/d_mesh_arrays.png"><img alt="../../_images/d_mesh_arrays.png" class="align-center" src="../../_images/d_mesh_arrays.png" style="width: 90%;" /></a>
<div class="section" id="elements">
<h3>Elements<a class="headerlink" href="#elements" title="Permalink to this headline">¶</a></h3>
<p>An <code class="docutils literal"><span class="pre">element_t</span></code> instance contains information needed by the framework and also
general information that could be useful to users. This includes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">elem_pts</span><span class="p">(:)</span>     <span class="n">An</span> <span class="n">array</span> <span class="n">of</span> <span class="n">points</span> <span class="n">defining</span> <span class="n">the</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">real</span> <span class="n">space</span><span class="p">(</span><span class="n">cartesian</span><span class="p">,</span> <span class="n">cylindrical</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>
<span class="n">quad_pts</span><span class="p">(:)</span>     <span class="n">An</span> <span class="n">array</span> <span class="n">of</span> <span class="n">points</span> <span class="n">defining</span> <span class="n">the</span> <span class="n">location</span> <span class="n">of</span> <span class="n">each</span> <span class="n">volume</span> <span class="n">quadrature</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">real</span> <span class="n">space</span><span class="o">.</span>
<span class="n">metric</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,:)</span>   <span class="n">An</span> <span class="n">array</span><span class="p">,</span> <span class="n">defining</span> <span class="k">for</span> <span class="n">each</span> <span class="n">quadrature</span> <span class="n">point</span><span class="p">,</span> <span class="n">a</span> <span class="n">matrix</span> <span class="n">of</span> <span class="n">element</span> <span class="n">metric</span> <span class="n">values</span><span class="o">.</span>
<span class="n">jinv</span><span class="p">(:)</span>         <span class="n">An</span> <span class="n">array</span> <span class="n">of</span> <span class="n">inverse</span> <span class="n">element</span> <span class="n">jacobian</span> <span class="n">values</span> <span class="n">at</span> <span class="n">each</span> <span class="n">volume</span> <span class="n">quadrature</span> <span class="n">node</span><span class="o">.</span>
<span class="n">grad1</span><span class="p">(:,:)</span>      <span class="n">An</span> <span class="n">array</span> <span class="n">of</span> <span class="n">gradients</span> <span class="n">of</span> <span class="n">the</span> <span class="n">basis</span> <span class="n">functions</span> <span class="k">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">physical</span> <span class="n">coordinates</span> <span class="n">at</span> <span class="n">volume</span> <span class="n">quadrature</span> <span class="n">nodes</span><span class="o">.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/d__element.png"><img alt="../../_images/d__element.png" class="align-center" src="../../_images/d__element.png" style="width: 80%;" /></a>
<div class="section" id="metric-terms">
<h4>Metric terms<a class="headerlink" href="#metric-terms" title="Permalink to this headline">¶</a></h4>
<p>Metric terms are computed by considering the transformation of a differential
volume in physical space to reference space as</p>
<div class="math">
\[\begin{split}\begin{pmatrix}
    dx \\ dy \\ dz
\end{pmatrix}
=
\begin{pmatrix}
  x_\xi  \quad  x_\eta  \quad  x_\zeta \\
  y_\xi  \quad  y_\eta  \quad  y_\zeta \\
  z_\xi  \quad  z_\eta  \quad  z_\zeta
\end{pmatrix}
\begin{pmatrix}
    d\xi \\ d\eta \\ d\zeta
\end{pmatrix}
\quad
\quad
\quad
\begin{pmatrix}
    dr \\ rd\theta \\ dz
\end{pmatrix}
=
\begin{pmatrix}
  r_\xi       \quad  r_\eta         \quad  r_\zeta \\
  r\theta_\xi \quad  r\theta_\eta   \quad  r\theta_\zeta \\
  z_\xi       \quad  z_\eta         \quad  z_\zeta
\end{pmatrix}
\begin{pmatrix}
    d\xi \\ d\eta \\ d\zeta
\end{pmatrix}\end{split}\]</div>
<p>The terms <span class="math">\(\partial \vec{x}/\partial \vec{\xi}\)</span> are computed from the polynomial
expansion representing the element coordinates as</p>
<div class="math">
\[x = \sum \psi \hat{x}   \quad\rightarrow\quad  \frac{\partial x}{\partial \xi} = \sum \frac{\partial \psi}{\partial \xi} \hat{x}\]</div>
<p>The element metric terms are obtained by inverting the matrices
<span class="math">\(\partial \vec{x}/\partial \vec{\xi}\)</span> to give</p>
<div class="math">
\[\begin{split}\mathcal{T} =
\begin{pmatrix}
  \xi_x   \quad \xi_y   \quad   \xi_z \\
  \eta_x  \quad \eta_y  \quad   \eta_z \\
  \zeta_x \quad \zeta_y \quad   \zeta_z
\end{pmatrix}
\quad
\quad
\quad
\mathcal{T} =
\begin{pmatrix}
   \xi_r   \quad   \xi_\theta   \quad   \xi_z  \\
   \eta_r  \quad   \eta_\theta  \quad   \eta_z \\
   \zeta_r \quad   \zeta_\theta \quad   \zeta_z
\end{pmatrix}\end{split}\]</div>
<p>Note, that the cylindrical element transformation matrix has <span class="math">\(r\)</span>-scaling included
implicitly since it was computed by inverting the mapping constructed previously.
The metric terms are defined at each quadrature point in the <code class="docutils literal"><span class="pre">metric(:,:,:)</span></code> component
of a given <code class="docutils literal"><span class="pre">element_t</span></code>. To access the matrix of metric components for a given quadrature
node <code class="docutils literal"><span class="pre">igq</span></code>, the component can be used as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">metric</span><span class="p">(:,:,</span><span class="n">igq</span><span class="p">)</span>
</pre></div>
</div>
<p>This returns the metric components(<code class="docutils literal"><span class="pre">Cartesian</span></code> or <code class="docutils literal"><span class="pre">Cylindrical</span></code>) at the quadrature node in a 3x3 matrix as</p>
<div class="math">
\[\begin{split}\begin{pmatrix}
  \xi_x   \quad \xi_y   \quad   \xi_z \\
  \eta_x  \quad \eta_y  \quad   \eta_z \\
  \zeta_x \quad \zeta_y \quad   \zeta_z
\end{pmatrix}
\quad
\quad
\quad
\begin{pmatrix}
   \xi_r   \quad   \xi_\theta   \quad   \xi_z  \\
   \eta_r  \quad   \eta_\theta  \quad   \eta_z \\
   \zeta_r \quad   \zeta_\theta \quad   \zeta_z
\end{pmatrix}\end{split}\]</div>
<p>Alternatively, a given metric term can be accessed for the set of quadrature nodes as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">metric</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:)</span>
</pre></div>
</div>
<p>which would return a 1D array of values for (<span class="math">\(\xi_x\)</span> or <span class="math">\(\xi_r\)</span>) corresponding to each
quadrature node in the set.</p>
<p>The inverse element jacobian terms(<code class="docutils literal"><span class="pre">Cartesian</span></code> or <code class="docutils literal"><span class="pre">Cylindrical</span></code>) <code class="docutils literal"><span class="pre">jinv(:)</span></code> are defined at each quadrature node as</p>
<div class="math">
\[ \begin{align}\begin{aligned}J^{-1} = ( x_\xi y_\eta z_\zeta  -  x_\eta y_\xi z_\zeta  -  x_\xi y_\zeta z_\eta  +  x_\zeta y_\xi z_\eta  +  x_\eta y_\zeta z_\xi  -  x_\zeta y_\eta z_\xi )\\J^{-1} = r ( r_\xi \theta_\eta z_\zeta  -  r_\eta \theta_\xi z_\zeta  -  r_\xi \theta_\zeta z_\eta  +  r_\zeta \theta_\xi z_\eta  +  r_\eta \theta_\zeta z_\xi  -  r_\zeta \theta_\eta z_\xi )\end{aligned}\end{align} \]</div>
</div>
<div class="section" id="gradients">
<h4>Gradients<a class="headerlink" href="#gradients" title="Permalink to this headline">¶</a></h4>
<p>Gradients of basis functions with respect to the reference coordinates
are not dependent on the physical coordinate system. So, any calculations
of the terms <span class="math">\(\partial \psi/\partial \vec{\xi}\)</span> do not need to be modified
with a change from one physical coordinate system to another.
These gradients are defined on a defined in a quadrature instance associated with an
element in the component <code class="docutils literal"><span class="pre">element%gq%vol</span></code>. For example, the component
<code class="docutils literal"><span class="pre">element%gq%vol%ddxi</span></code> gives:</p>
<div class="math">
\[\begin{split}\frac{\partial \psi_{igq, imode}}{\partial \xi} =
    \begin{pmatrix}
        \frac{\partial \psi_{1,1}}{\partial \xi} &amp;  \frac{\partial \psi_{1,2}}{\partial \xi}  &amp; \cdots  &amp; \frac{\partial \psi_{1,N}}{\partial \xi} \\
        \frac{\partial \psi_{2,1}}{\partial \xi}  &amp; \frac{\partial \psi_{2,2}}{\partial \xi}  &amp; \cdots  &amp; \frac{\partial \psi_{2,N}}{\partial \xi} \\
        \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
        \frac{\partial \psi_{{ngq},1}}{\partial \xi} &amp; \frac{\partial \psi_{{ngq},2}}{\partial \xi} &amp;  \cdots &amp;  \frac{\partial \psi_{{ngq},N}}{\partial \xi} \\
    \end{pmatrix}\end{split}\]</div>
<p>Gradients with respect to the physical coordinate system do change depending on the
coordinate system being used. The gradient for Cartesian and Cylindrical coordinates is</p>
<div class="math">
\[\begin{split}\nabla f &amp;= \frac{\partial f}{\partial x}\hat{x}  +  \frac{\partial f}{\partial y}\hat{y}  +  \frac{\partial f}{\partial z}\hat{z} \\
\nabla f &amp;= \frac{\partial f}{\partial r}\hat{r}  +  \frac{1}{r}\frac{\partial f}{\partial \theta}\hat{\theta}  +  \frac{\partial f}{\partial z}\hat{z}\end{split}\]</div>
<p>The coordinate transformation for the gradient from reference space to physical space
is computed using the transpose of the element metric matrix as</p>
<div class="math">
\[\nabla_x \psi = \mathcal{T}^T \nabla_\xi \psi\]</div>
<p>For the Cartesian and Cylindrical coordinate systems, these are expanded as</p>
<div class="math">
\[\begin{split}\nabla_{\vec{x}} \psi
=
\begin{bmatrix}
    \xi_x   &amp;   \eta_x  &amp;   \zeta_x \\
    \xi_y   &amp;   \eta_y  &amp;   \zeta_y \\
    \xi_z   &amp;   \eta_z  &amp;   \zeta_z \\
\end{bmatrix}
\begin{bmatrix}
    \psi_\xi \\ \psi_\eta \\ \psi_\zeta
\end{bmatrix}
\\
\nabla_{\vec{r}} \psi
=
\begin{bmatrix}
    \xi_r       &amp;   \eta_r      &amp;   \zeta_r      \\
    \xi_\theta  &amp;   \eta_\theta &amp;   \zeta_\theta \\
    \xi_z       &amp;   \eta_z      &amp;   \zeta_z      \\
\end{bmatrix}
\begin{bmatrix}
    \psi_\xi \\ \psi_\eta \\ \psi_\zeta
\end{bmatrix}\end{split}\]</div>
<p>Note that the terms <span class="math">\(\nabla_{\vec{x}} \psi\)</span> and <span class="math">\(\nabla_{\vec{r}} \psi\)</span> are the gradient
vectors and not the directional derivatives. For the Cartesian coordinate system, these
things are identical. For the cylindrical coordinate system,
they are not.</p>
<p>Gradients of basis functions with respect to the pysical coordinate system
in an <code class="docutils literal"><span class="pre">element_t</span></code> can be accessed in the <code class="docutils literal"><span class="pre">grad1(:,:)</span></code>, <code class="docutils literal"><span class="pre">grad2(:,:)</span></code>,
and <code class="docutils literal"><span class="pre">grad3(:,:)</span></code>  components. For example, the <code class="docutils literal"><span class="pre">element%grad1</span></code> component
contains the gradient along the 1st physical coordinate for all basis functions at all
quadrature nodes as:</p>
<div class="math">
\[\begin{split}\nabla_1 \psi_{ngq, nmode} =
    \begin{pmatrix}
        \nabla_1 \psi_{1,1}  &amp;  \nabla_1 \psi_{1,2}  &amp; \cdots  &amp; \nabla_1 \psi_{1,N} \\
        \nabla_1 \psi_{2,1}  &amp;  \nabla_1 \psi_{2,2}  &amp; \cdots  &amp; \nabla_1 \psi_{2,N} \\
        \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
        \nabla_1 \psi_{{ngq},1}  &amp; \nabla_1 \psi_{{ngq},2}  &amp;  \cdots &amp;  \nabla_1 \psi_{{ngq},N} \\
    \end{pmatrix}\end{split}\]</div>
</div>
</div>
<div class="section" id="faces">
<h3>Faces<a class="headerlink" href="#faces" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="../../_images/d__face.png"><img alt="../../_images/d__face.png" class="align-center" src="../../_images/d__face.png" style="width: 90%;" /></a>
<div class="section" id="face-metrics">
<h4>Face metrics<a class="headerlink" href="#face-metrics" title="Permalink to this headline">¶</a></h4>
<p>Metric terms for the <code class="docutils literal"><span class="pre">face_t</span></code> data structure are defined exactly the same as for the
<code class="docutils literal"><span class="pre">element_t</span></code> data structure. The difference is that the <code class="docutils literal"><span class="pre">metric</span></code> and <code class="docutils literal"><span class="pre">jinv</span></code> components of
<code class="docutils literal"><span class="pre">face_t</span></code> return values for boundary quadrature nodes. This contrasts the <code class="docutils literal"><span class="pre">element_t</span></code>
structure, which returns values for volume quadrature nodes.</p>
</div>
<div class="section" id="face-normals">
<h4>Face normals<a class="headerlink" href="#face-normals" title="Permalink to this headline">¶</a></h4>
<div class="math">
\[\vec{x} = [x, y, z]     \quad   \vec{\xi} = [\xi, \eta, \zeta]\]</div>
<p>Face normal vectors are stored for each face quadrature node. The component <code class="docutils literal"><span class="pre">norm</span></code> is the
face normal vector with respect to computational coordinates on a reference element
(<span class="math">\(\xi\)</span>, <span class="math">\(\eta\)</span>, <span class="math">\(\zeta\)</span>) as</p>
<div class="math">
\[\vec{n}_{\xi_k} = \frac{\partial \vec{x}}{\partial \xi_i} \times \frac{\partial \vec{x}}{\partial \xi_j}\]</div>
<p>where <span class="math">\(\xi_i\)</span> and <span class="math">\(\xi_j\)</span> are the in-place coordinates of face <span class="math">\(\xi_k\)</span>.
In this was, the normal vectors for <span class="math">\(\xi\)</span>, <span class="math">\(\eta\)</span>, and <span class="math">\(\zeta\)</span> faces
are defined respectively as</p>
<div class="math">
\[ \begin{align}\begin{aligned}\vec{n}_\xi =
\frac{\partial \vec{x}}{\partial \eta} \times \frac{\partial \vec{x}}{\partial \zeta} =
[ y_\eta z_\zeta - y_\zeta z_\eta, \quad x_\zeta z_\eta - x_\eta z_\zeta, \quad x_\eta y_\zeta - x_\zeta y_\eta] =
[ \xi_x, \quad \xi_y, \quad \xi_z ]\\\vec{n}_\eta =
\frac{\partial \vec{x}}{\partial \zeta} \times \frac{\partial \vec{x}}{\partial \xi} =
[ y_\zeta z_\xi - y_\xi z_\zeta, \quad x_\xi z_\zeta - x_\zeta z_\xi, \quad x_\zeta y_\xi - x_\xi y_\zeta ] =
[ \eta_x, \quad \eta_y, \quad \eta_z ]\\\vec{n}_\zeta =
\frac{\partial \vec{x}}{\partial \xi} \times \frac{\partial \vec{x}}{\partial \eta} =
[ y_\xi z_\eta - y_\eta z_\xi, \quad x_\eta z_\xi - x_\xi z_\eta, \quad x_\xi y_\eta - x_\eta y_\xi] =
[ \zeta_x, \quad \zeta_y, \quad \zeta_z ]\end{aligned}\end{align} \]</div>
<p>Applying the above formula to element faces produces normal vectors that are inward
facing for <span class="math">\(\xi = -1\)</span> faces and outward facing for <span class="math">\(\xi = 1\)</span> faces.
Inward facing vectors are negated so that all resultant normal vectors in the <code class="docutils literal"><span class="pre">norm</span></code>
component are outward facing. This applied to <span class="math">\(\eta\)</span> and <span class="math">\(\zeta\)</span> faces as well.</p>
<p>Unit normal vectors can be accessed in the <code class="docutils literal"><span class="pre">unorm</span></code> component and are computed as</p>
<div class="math">
\[\hat{n}_{\xi_i} = \frac{\vec{n}_{\xi_i}}{||\vec{n}_{\xi_i}||_2}\]</div>
</div>
</div>
<div class="section" id="chimera-interfaces">
<h3>Chimera Interfaces<a class="headerlink" href="#chimera-interfaces" title="Permalink to this headline">¶</a></h3>
<p>Each <code class="docutils literal"><span class="pre">domain_t</span></code> instance contains a <code class="docutils literal"><span class="pre">mesh%chimera</span></code> component that holds all information
regarding chimera communication for that particular mesh block. This takes the
form of <code class="docutils literal"><span class="pre">chimera_receiver</span></code> and <code class="docutils literal"><span class="pre">chimera_donor</span></code> components. Currently, only
the <code class="docutils literal"><span class="pre">chimera_receiver</span></code> is utilized. <code class="docutils literal"><span class="pre">chimera_donor</span></code> will be used to facilitate
communication between processors for parallel code execution.</p>
<a class="reference internal image-reference" href="../../_images/d__chimera_receiver.png"><img alt="../../_images/d__chimera_receiver.png" class="align-center" src="../../_images/d__chimera_receiver.png" style="width: 90%;" /></a>
<p>In a given <code class="docutils literal"><span class="pre">domain_t</span></code>, every face that gets information from a separate block is
designated as a CHIMERA face, it is assigned an integer ID <code class="docutils literal"><span class="pre">face%ChiID</span></code>, and it gets an
entry in the <code class="docutils literal"><span class="pre">mesh%chimera%recv%data</span></code> components. It can be accessed as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mesh</span><span class="o">%</span><span class="n">chimera</span><span class="o">%</span><span class="n">recv</span><span class="o">%</span><span class="n">data</span><span class="p">(</span><span class="n">ChiID</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>Consider an example with two mesh domains, as shown below.
<code class="docutils literal"><span class="pre">mesh(1)</span></code> contains four elements. <code class="docutils literal"><span class="pre">mesh(2)</span></code> contains eight elements.
<code class="docutils literal"><span class="pre">mesh(1)</span></code> overlaps with <code class="docutils literal"><span class="pre">mesh(2)</span></code>. In particular, the top faces of elements E3 and E4 lie
inside <code class="docutils literal"><span class="pre">mesh(2)</span></code>. These faces are designated as CHIMERA faces and are given a mesh-global
chimera ID. The top face of E3 is given the ID ChiID=1 and the top face of E4 is given
the ID ChiID=2.</p>
<a class="reference internal image-reference" href="../../_images/d__chimera_demo_a.png"><img alt="../../_images/d__chimera_demo_a.png" class="align-center" src="../../_images/d__chimera_demo_a.png" style="width: 90%;" /></a>
<p>Each CHIMERA face has its own set of chimera information, which can be accessed via
<code class="docutils literal"><span class="pre">mesh%chimera%recv%data(ChiID)</span></code>. This is shown below for the two faces in this example.</p>
<a class="reference internal image-reference" href="../../_images/d__chimera_demo_b.png"><img alt="../../_images/d__chimera_demo_b.png" class="align-center" src="../../_images/d__chimera_demo_b.png" style="width: 90%;" /></a>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../equations/detail_equations.html" class="btn btn-neutral float-right" title="Equation Sets" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../architecture/detail_architecture.html" class="btn btn-neutral" title="Finding your way around ChiDG" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Nathan A. Wukie.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../_static/mathjax_conf.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-80530851-1', 'auto');
    ga('set', 'location', 'http://nwukie.github.io/ChiDG_site/');
    ga('send', 'pageview');
</script>


</body>
</html>